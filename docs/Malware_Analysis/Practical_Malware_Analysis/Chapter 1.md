# Chapter 1
## Lab 1-1
This lab uses the files __Lab01-01.exe__ and __Lab01-01.dll__. Use the tools and techniques described in the chapter to gain information about the files and answer the questions below.
### Questions
1. Upload the files to http://www.VirusTotal.com/ and view the reports. Does either file match any existing antivirus signatures?
   * Yes there are detections by various AV vendors.
2. When were these files compiled?
   * Based on PEStudio, `Lab01-01.exe` was compiled on 19 Dec 2010 16:16:19 and `Lab01-01.dll` was compiled on 19 Dec 2010 16:16:38 
3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?
   * Based on PEiD, the low Entropy as well as the imports being very obvious there are no signs of packing  
   * Malware does not seem to be obfuscated as there is a lot of plain text around and entropy is low.
4. Do any imports hint at what this malware does? If so, which imports are they?
   * Lab01-01.exe

|Imports|Function|
|---|---|
|MapViewOfFile,CreateFileMappingA|Loads File into ram and can be used to execute a file without using Windows Loader|

   * Lab01-01.dll

|Imports|Function|
|---|---|
|ws2_32.dll : socket, send, recv, inetaddr|Using sockets to send and receive data|
|CreateProcessA|Creates a new process|

5. Are there any other files or host-based indicators that you could look for on infected systems?
   * Based on the strings of `Lab01-01.exe` we can see that there is a particular file path `C:\windows\system32\kerne132.dll`. `1` is used instead of `l` which might be indicative of a malicious `.dll` in that path. We could be able to find this `kerne132.dll` on the infected host.
   
6. What network-based indicators could be used to find this malware on infected machines?
   * Based on the strings of `Lab01-01.dll`, we see what seems to be an IP address `127.26.152.13`. We could filter for this IP address when we look through the network logs.
 
7. What would you guess is the purpose of these files?
   * It is likely that `Lab01-01.exe` is likely the loader and `Lab01-01.dll` likely contains the file malicious payload. 
   * One possibility is also that `Lab01-01.exe` is executed and it will change the name of `Lab01-01.dll` to `kernel132.dll` 
   * It might be a reverse shell/beacon as there are network connectivity imports in the `.dll` as well as a hardcoded IP address.

#### Lab01-01.exe

|Tool|Evidence|
|---|---|
|VirusTotal|![[Pasted image 20220618215206.png]]|
|Classification|![[Pasted image 20220618201833.png]]|
|Identify Packing/Obfuscatin|![[Pasted image 20220618212408.png]]|
|Imports|![[Pasted image 20220618220228.png]]
|Strings|![[Pasted image 20220618224723.png]]|

#### Lab01-01.dll

|Tool|Evidence|
|---|---|
|VirusTotal|![[Pasted image 20220618215301.png]]|
|Classification|![[Pasted image 20220618202103.png]]|
|Identify Packer/Obfuscation|![[Pasted image 20220618212518.png]]|
|Imports|![[Pasted image 20220618220117.png]]|
|Strings|![[Pasted image 20220618224805.png]]|

---
## Lab 1-2
Analyze the file Lab01-02.exe.
### Questions
1. Upload the Lab01-02.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?
   * Yes, there are detection by various AVs.
2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
   * Packing is observed, due to the unusually small amount of imports and strings that does not make sense. 
   * It is packed by UPX. This can be seen using PEiD and the section headers when using CFF explorer or PEStudio.
   * File can be unpacked using CFF explorer built*in UPX unpacker.
3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?

|Import(s)|Function|
|---|---|
|CreateServiceA, <br> OpenSCManagerA|Maintain Persistency by creating a service|
|InternetOpenUrlA, <br> InternetOpenA|Surfs a webpage|

4. What host- or network-based indicators could be used to identify this malware on infected machines?
   * Based on the string we see a URL `www.malwareanalysisbook.com` and we can filter for this URL in network logs if it exists.
   * As this malware could possibly create a service, `Malservice` could be a possible host based indicator. We can check Windows Event Logs with `EventViewer`, under `Windows Logs`> `System` and look for events with the Source set to _Service Control Manager (SCM)_.
   * We can also look at `Applications and Services Logs` and look for malservice to see what it did.
#### Packed Malware

|Purpose|Evidence|
|---|---|
|VirusTotal|![[Pasted image 20220618231202.png]]|
|Classification|![[Pasted image 20220618232140.png]]|
|Identify Packing/Obfuscation|![[Pasted image 20220618232213.png]] ![[Pasted image 20220618232246.png]]|
|Imports|![[Pasted image 20220618232409.png]]![[Pasted image 20220618232428.png]]|
|Strings|![[Pasted image 20220618232554.png]]![[Pasted image 20220618232622.png]]|

#### Unpacked Malware

|Purpose|Evidence|
|---|---|
|VirusTotal|![[Pasted image 20220618233706.png]]|
|Classfication|![[Pasted image 20220618233718.png]]|
|Imports|![[Pasted image 20220618233727.png]]![[Pasted image 20220618233733.png]]|
|Strings|![[Pasted image 20220618233926.png]]![[Pasted image 20220618233931.png]]|

---
## Lab 1-3 
Analyze the file Lab01-03.exe.
### Questions
1. Upload the Lab01-03.exe file to http://www.VirusTotal.com/. Does it match any existing antivirus definitions?
   * Yes there are detections by various AVs.
2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
   * Yes although entropy level is low but imports only has 2 functions, the section headers are empty and the lack of strings indicate the possibility packing. 
   * PEiD, DiE and PEStudio all shows packing with signature `FSG 1.0` . 
   * We can follow the instructions to unpack using a debugger [here](https://www.aldeid.com/wiki/Category:Digital*Forensics/Computer*Forensics/Anti*Reverse*Engineering/Packers/FSG) and [here](https://www.goggleheadedhacker.com/blog/post/6) .
3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?
   * Import functions tell us that this malware is packed.
4. What host- or network-based indicators could be used to identify this malware on infected machines?

#### Packed 

|Purpose|Evidence|
|---|---|
|VirusTotal|![[Pasted image 20220619003547.png]]|
|Classfication|![[Pasted image 20220619003554.png]]|
|Identify Packer/Obfuscation|![[Pasted image 20220619003615.png]]![[Pasted image 20220619003635.png]]![[Pasted image 20220619003656.png]]|
|Imports|![[Pasted image 20220619003806.png]]![[Pasted image 20220619003812.png]]|
|Strings|![[Pasted image 20220619003821.png]]|

#### Unpacked

|Purpose|Evidence|
|---|---|
|VirusTotal||
|Classfication||
|Imports||
|Strings||

---
## Lab 1-4
Analyze the file Lab01-04.exe.
### Questions
1. Upload the Lab01-04.exe file to http://www.VirusTotal.com/. Does it match
any existing antivirus definitions?
2. Are there any indications that this file is packed or obfuscated? If so,
what are these indicators? If the file is packed, unpack it if possible.
3. When was this program compiled?
4. Do any imports hint at this program’s functionality? If so, which imports
are they and what do they tell you?
5. What host- or network-based indicators could be used to identify this
malware on infected machines?
6. This file has one resource in the resource section. Use Resource Hacker
to examine that resource, and then use it to extract the resource. What
can you learn from the resource?

|Purpose|Evidence|
|---|---|
|VirusTotal||
|Classfication||
|Imports||
|Strings||
|Resources||